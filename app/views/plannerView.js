define(["require","exports","module","view/weekdayView","util/helper"],function(e,t){function s(e,t,n){var r=e.index,i=n.get("lessons")[t][r];u(i,t,n),n.allocate(t,r)}function o(e){var t,n,s,o,u;t=!0;for(n=0,s=e.length;n<s;n++){o=r.getTimeIndex(e[n].startTime),u=r.getTimeIndex(e[n].endTime)-o;if(i[e[n].weekDay].hasEmptySlots(o,u)!==0){t=!1;break}}return t}function u(e,t,n,r){var s,o;for(s=0,o=e.length;s<o;s++)i[e[s].weekDay].allocate(s,e[s],t,n,r)}var n=e("view/weekdayView"),r=e("util/helper"),i={};t.init=function(){var e,t=planner.weekDays.length;for(e=0;e<t;e++)i[planner.weekDays[e]]=new n(planner.weekDays[e]);$("#tt-grid").on("contextmenu",function(e){e.preventDefault()})},$.subscribe("grid:module:droppable",function(e,t,n,r){var i=t.index,s=r.get("lessons")[n],o;for(o in s)s.hasOwnProperty(o)&&o!==i&&u(s[o],n,r,!0)}),$.subscribe("grid:module:allocate",function(e,t,n,r){s(t,n,r)}),$.subscribe("grid:module:reallocate",function(e,t){var n,r=t.get("lessons"),i;for(n in r)r.hasOwnProperty(n)&&(i=t.allocated(n),i&&s(r[n][i][0],n,t))}),$.subscribe(planner.list.modules+":addOne",function(e,t){if(!t.is("visible"))return;var n,r=t.get("lessons"),i,s,a;for(n in r)if(r.hasOwnProperty(n))if(t.allocated(n))s=r[n][t.allocated(n)],u(s,n,t),t.allocate(n,s[0].index);else{i=!1,s=r[n];for(a in s)if(s.hasOwnProperty(a)&&o(s[a])){u(s[a],n,t),t.allocate(n,a),i=!0;break}i||(a=Object.keys(s)[0],u(s[a],n,t),t.allocate(n,a))}})});