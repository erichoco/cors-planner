define(["require","exports","module","model/modules","util/store"],function(e,t){function o(){r.populate(s.get(planner.list.modules)||[])}function u(){s.set(planner.list.modules,r.toJSON())}var n=e("model/modules"),r=new n(planner.list.modules),i=new n(planner.list.previews),s=e("util/store");t.init=function(){setTimeout(function(){o()},500)},$.subscribe("module:save",function(){u()}),$.subscribe("module:add",function(e,t){var n=i.get(t);n?(i.remove(n),r.add(n)):r.add(t)}),$.subscribe("module:preview",function(e,t){var n=r.get(t)||i.get(t);n?$.publish("module:detail",n):i.add(t)}),$.subscribe("module:remove",function(e,t){var n=r.remove(t);n&&$.publish("message:success","Module "+n.get("code")+" is removed")}),$.subscribe("module:clean",function(){r.clean(),$.publish("module:clean:all"),$.publish("message:success","All modules are removed")}),$.subscribe(planner.list.previews+":addOne",function(){i.length()>20&&i.clean()})});