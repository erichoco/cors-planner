define(["require","exports","module","helper/colors"],function(e,t){function r(e,t){if(!e)throw new Error("Module data cannot be null!");this.id=e.code.replace(/[_\s\'\"]/gi,"-"),this.data=r.Format(e),this.data.color=n.get(this.data.color),this.status=$.extend({},{allocated:{lectures:null,tutorials:null,labs:null}},t)}function i(e){var t,n=0,r,i,s,o={};for(i in e)if(e.hasOwnProperty(i)){r=e[i].length;for(t=0;t<r;t++)s=e[i][t].classNo,o[s]||(o[s]=[]),o[s].push(e[i][t])}return o}var n=e("helper/colors");return r.Count=function(e){var t,n=0;for(t in e)e.hasOwnProperty(t)&&$.isArray(e[t])&&(n+=e[t].length);return n},r.Format=function(e){return e.alterFormat?e:(e.alterFormat=!0,!$.isEmptyObject(e.lectures)&&!e.hasLecture&&(e.hasLecture=!0,e._lectures=i(e.lectures)),!$.isEmptyObject(e.tutorials)&&!e.hasTutorial&&(e.hasTutorial=!0,e._tutorials=i(e.tutorials)),!$.isEmptyObject(e.labs)&&!e.hasLab&&(e.hasLab=!0,e._labs=i(e.labs)),e)},r.fn=r.prototype,r.fn.get=function(e){return this.data[e]},r.fn.has=function(e){return e=e.toLowerCase(),!$.isEmptyObject(this.data[e])},r.fn.set=function(e,t){var n,r=e.split("."),i=r.length,s=this.status;for(n=0;n<i-1;n++)s[r[n]]=s[r[n]]||{},s=s[r[n]];s[r[n]]=t,$.publish("module:save")},r.fn.is=function(e,t){var n,r=e.split("."),i=r.length,s=this.status;for(n=0;n<i-1;n++)s[r[n]]=s[r[n]]||{},s=s[r[n]];return s[r[n]]===t},r.fn.count=function(e){e=e.toLowerCase();if(e==="lectures")return r.Count(this.data.lectures);if(e==="tutorials")return r.Count(this.data.tutorials);if(e==="labs")return r.Count(this.data.labs)},r.fn.isSame=function(e){return typeof e=="object"?this.data.code===e.get("code"):typeof e=="string"?this.data.code===e.toUpperCase():!1},r.fn.allocated=function(e){return this.status.allocated[e]},r.fn.allocate=function(e,t){this.status.allocated[e]=t,$.publish("module:"+this.get("code")+":allocated",[e,t]),$.publish("module:save")},r.fn.toJSON=function(){return{data:this.data,status:this.status}},r});