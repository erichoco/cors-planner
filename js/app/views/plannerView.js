define(["require","exports","module","view/weekdayView","util/helper"],function(e,t){function s(e,t,n){var r=e.classNo,i=n.get("_"+t)[r];u(i,t,n),n.allocate(t,r)}function o(e){var t,n,s,o,u;t=!0;for(n=0,s=e.length;n<s;n++){o=r.getTimeIndex(e[n].startTime),u=r.getTimeIndex(e[n].endTime)-o;if(i[e[n].weekDay].hasEmptySlots(o,u)!==0){t=!1;break}}return t}function u(e,t,n,r){var s,o;for(s=0,o=e.length;s<o;s++)i[e[s].weekDay].allocate(s,e[s],t,n,r)}var n=e("view/weekdayView"),r=e("util/helper"),i={};t.init=function(){var e,t=planner.weekDays.length;for(e=0;e<t;e++)i[planner.weekDays[e]]=new n(planner.weekDays[e])},$.subscribe("grid:module:droppable",function(e,t,n,r){var i=t.classNo,s=r.get("_"+n),o;for(o in s)s.hasOwnProperty(o)&&o!==i&&u(s[o],n,r,!0)}),$.subscribe("grid:module:allocate",function(e,t,n,r){s(t,n,r)}),$.subscribe("grid:module:reallocate",function(e,t){var n,r,i,o=["lectures","tutorials","labs"];for(n=0,r=o.length;n<r;n++)t.has(o[n])&&(i=t.allocated(o[n]))!==null&&s(t.get("_"+o[n])[i][0],o[n],t)}),$.subscribe(planner.list.modules+":addOne",function(e,t){if(!t.is("visible"))return;var n,r,i,a,f,l=["lectures","tutorials","labs"];for(r=0,i=l.length;r<i;r++)if(t.has(l[r]))if(t.allocated(l[r])!==null)s(t.get("_"+l[r])[t.allocated(l[r])][0],l[r],t);else{f=!1,n=t.get("_"+l[r]);for(a in n)if(n.hasOwnProperty(a)&&o(n[a])){u(n[a],l[r],t),t.allocate(l[r],a),f=!0;break}f||(a=Object.keys(n)[0],u(n[a],l[r],t),t.allocate(l[r],a))}})});