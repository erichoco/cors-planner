define(["require","exports","module","view/weekdayView","util/helper"],function(e,t){function s(e){var t,n,s,o,u;t=!0;for(n=0,s=e.length;n<s;n++){o=r.getTimeIndex(e[n].startTime),u=r.getTimeIndex(e[n].endTime)-o;if(i[e[n].weekDay].hasEmptySlots(o,u)!==0){t=!1;break}}return t}function o(e,t,n,r){var s,o;for(s=0,o=e.length;s<o;s++)i[e[s].weekDay].allocate(s,e[s],t,n,r)}var n=e("view/weekdayView"),r=e("util/helper"),i={};t.init=function(){var e,t=planner.weekDays.length;for(e=0;e<t;e++)i[planner.weekDays[e]]=new n(planner.weekDays[e])},$.subscribe("grid:module:droppable",function(e,t,n,r){var i=t.classNo,s=r.get("_"+n),u;for(u in s)s.hasOwnProperty(u)&&u!==i&&o(s[u],n,r,!0)}),$.subscribe("grid:module:allocate",function(e,t,n,r){var i=t.classNo,s=r.get("_"+n)[i];o(s,n,r),r.allocate(n,i)}),$.subscribe(planner.list.modules+":addOne",function(e,t){var n,r,i,u,a,f=["lectures","tutorials","labs"];for(r=0,i=f.length;r<i;r++)if(t.has(f[r]))if(t.allocated(f[r])!==null)$.publish("grid:module:allocate",[t.get("_"+f[r])[t.allocated(f[r])][0],f[r],t]);else{a=!1,n=t.get("_"+f[r]);for(u in n)if(n.hasOwnProperty(u)&&s(n[u])){o(n[u],f[r],t),t.allocate(f[r],u),a=!0;break}a||(u=Object.keys(n)[0],o(n[u],f[r],t),t.allocate(n[u].classNo))}})});