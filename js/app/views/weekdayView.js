define(["require","exports","module","helper/jquery.slot","hgn!template/timeSlot"],function(e,t){function i(e){this.name=e.toLowerCase(),this.$elem=$("#"+this.name),this.$rows=[];var t,n,r=this.$elem.find(".row-fluid");for(t=0,n=r.length;t<n;t++)this.$rows.push($(r[t]));$.subscribe("grid:rows:clearEmpty",$.proxy(this.removeEmptyRows,this))}function s(e,t,n,r){var i=e+t,s=n+r;return n>=e&&n<i?!0:s>e&&s<=i?!0:n<=e&&s>=i?!0:!1}function o(e){return e=parseInt(e,10),2+(Math.floor(e/100)-8)*2+(e%100?1:0)}function u(e){var t=$(r(e));return t.slot(e),t}e("helper/jquery.slot");var n={lectures:"(L)",tutorials:"(T)",labs:"(Lab)"},r=e("hgn!template/timeSlot");return i.fn=i.prototype,i.fn.allocate=function(e,t,r,i,s){var a=o(t.startTime),f=o(t.endTime)-a,l=this.hasEmptySlots(a,f);l===-1&&(this.createNewRow(),l=this.$rows.length-1);var c={code:i.get("code"),type:r,shortType:n[r],index:e,offset:a,span:f,slot:t,data:i.data,module:i,droppable:s||!1};this.$rows[l].append(u(c))},i.fn.createNewRow=function(){var e=this.$rows[1].clone();e.find(".slot").remove(),this.$rows.push(e),this.$elem.append(e),$(window).resize()},i.fn.removeEmptyRows=function(){var e,t;for(e=this.$rows.length-1;e>1;e--)this.$rows[e].find(".slot").length===0&&(this.$rows[e].remove(),this.$rows.splice(e,1));this.$rows[0].find(".slot").length===0&&(e=this.$rows.length===2?1:2,t=this.$rows[e].find(".slot").detach(),this.$rows[0].append(t),e===2&&(this.$rows[2].remove(),this.$rows.splice(e,1))),this.$rows[1].find(".slot").length===0&&this.$rows.length>2&&(t=this.$rows[2].find(".slot").detach(),this.$rows[1].append(t),this.$rows[2].remove(),this.$rows.splice(2,1)),this.mergeRows()},i.fn.mergeRows=function(){var e,t,n,r,i,s;for(e=this.$rows.length-1;e>0;e--){i=this.$rows[e].find(".slot");for(t=i.length-1,n=0;t>=0;t--)s=$(i[t]),r=this._hasEmptySlots(s.data("offset"),s.data("span"),e),r!==-1&&(s.detach(),this.$rows[r].append(s),n++);n!==0&&e!==1&&n===i.length&&(this.$rows[e].remove(),this.$rows.splice(e,1))}$(window).resize()},i.fn._hasEmptySlots=function(e,t,n){var r,i,o,u,a,f;for(i=0;i<n;i++){r=!0,a=this.$rows[i].find(".slot");for(o=0,u=a.length;o<u;o++){f=$(a[o]);if(s(f.data("offset"),f.data("span"),e,t)){r=!1;break}}if(r)return i}return-1},i.fn.hasEmptySlots=function(e,t){return this._hasEmptySlots(e,t,this.$rows.length)},i});