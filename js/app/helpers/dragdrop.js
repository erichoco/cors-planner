define(["require","exports","module","helper/solver"],function(require,exports){var solver=require("helper/solver");(function($){function getTimeIndex(t){return t=parseInt(t,10),(Math.floor(t/100)-8)*2+1+(t%100?1:0)}function createDroppableSlots(code,type,klass,that){var key,info,top,left,width,$div,data;$gridTr=$gridTr||$grid.find("tbody").find("tr"),$gridTd=$gridTd||$($gridTr[0]).find("td"),$gridWidth=$gridTr[0].offsetWidth,$slot.detach();for(key in klass)klass.hasOwnProperty(key)&&that.slotKey!==key&&(data=$.extend({},that,{slotKey:key}),info=key.split("-"),top=$gridTr[weekDays[info[0]]].offsetTop+2,left=$gridTd[getTimeIndex(info[1])].offsetLeft+1,width=$gridTd[getTimeIndex(info[2])].offsetLeft-left,left=left/$gridWidth*100+"%",width=width/$gridWidth*100+"%",$div=$("<div>").addClass("bar temp-slot "+type).data("slot",data).text(code+" "+types[type]).css({top:top,left:left,width:width}).droppable(that.dropOpts),$div.appendTo($slot));$slot.appendTo($el)}function DragDrop(element){this.elem=element,this.$elem=$(element),this.init()}var $el=$("#timetable"),$slot=$("#table-slot"),$grid=$("#table-grid"),$gridTr,$gridTd,$gridWidth,weekDays={MONDAY:0,TUESDAY:1,WEDNESDAY:2,THURSDAY:3,FRIDAY:4},types={lectures:"(L)",tutorials:"(T)",labs:"(Lab)"};DragDrop.fn=DragDrop.prototype,DragDrop.fn.init=function(){var that=this;this.module=$.data(this.elem,"module"),this.dragOpts={opacity:.6,helper:"clone",appendTo:"#primary-panel",revert:"invalid",revertDuration:200,zIndex:1e3,containment:"#primary-panel",start:$.proxy(that.dragStart,that),stop:$.proxy(that.dragStop,that)},this.dropOpts={activeClass:"bar-active",hoverClass:"bar-hover",drop:$.proxy(that.dropEvent,that)},this.$elem.on("mouseenter",".draggable",function(){var $this=$(this);$this.hasClass("ui-draggable")||that.bindDragEvent($this)})},DragDrop.fn.bindDragEvent=function(elem){elem.draggable(this.dragOpts)},DragDrop.fn.dragStart=function(event,ui){var $this=$(event.target),id=$this.attr("id"),info=id?id.split("-"):undefined,data=info?{id:info[0],type:info[1],module:this.module,slots:this.module.get(info[1]),elem:$this,dropOpts:this.dropOpts}:$this.data("slot");createDroppableSlots(data.id,data.type,data.slots,data)},DragDrop.fn.dragStop=function(event,ui){$slot.find(".temp-slot").remove()},DragDrop.fn.dropEvent=function(event,ui){var $this=$(event.target),$that=ui.draggable;ui.helper.remove(),$that.hasClass("bar")?$that.remove():$that.removeClass("draggable").draggable("disable"),$this.css("background-color","grey").removeClass("temp-slot").addClass("draggable").droppable("destroy").draggable(this.dragOpts),$slot.find(".temp-slot").remove()},$.fn.dragdrop=function(){return this.each(function(){$.data(this,"DragDrop")||$.data(this,"DragDrop",new DragDrop(this))})}})(jQuery)})