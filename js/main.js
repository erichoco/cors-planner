define("app/global",["require","exports","module"],function(require,exports){(function(){var Fn=Function,global=(new Fn("return this"))();global.planner||(global.planner={}),planner.get=function(key){return this[key]},planner.set=function(key,value){this[key]=value,$.publish("planner:"+key,[value])},planner.version="0.0.6",planner.dataUpdate="27 Aug 2012 17:57",planner.timetable="horizontal",planner.list=planner.list||{},planner.list.modules="modules",planner.list.previews="previews"})()}),function($){var o=$({});$.subscribe=function(){o.on.apply(o,arguments)},$.unsubscribe=function(){o.off.apply(o,arguments)},$.publish=function(){o.trigger.apply(o,arguments)}}(jQuery),define("util/pubsub",function(){}),define("helper/solver",["require","exports","module"],function(require,exports){}),define("helper/dragdrop",["require","exports","module","helper/solver"],function(require,exports){var solver=require("helper/solver");(function($){function getTimeIndex(t){return t=parseInt(t,10),(Math.floor(t/100)-8)*2+1+(t%100?1:0)}function createDroppableSlots(code,type,klass,that){var key,info,top,left,width,$div,data;$gridTr=$gridTr||$grid.find("tbody").find("tr"),$gridTd=$gridTd||$($gridTr[0]).find("td"),$gridWidth=$gridTr[0].offsetWidth,$slot.detach();for(key in klass)klass.hasOwnProperty(key)&&that.slotKey!==key&&(data=$.extend({},that,{slotKey:key}),info=key.split("-"),top=$gridTr[weekDays[info[0]]].offsetTop+2,left=$gridTd[getTimeIndex(info[1])].offsetLeft+1,width=$gridTd[getTimeIndex(info[2])].offsetLeft-left,left=left/$gridWidth*100+"%",width=width/$gridWidth*100+"%",$div=$("<div>").addClass("bar temp-slot "+type).data("slot",data).text(code+" "+types[type]).css({top:top,left:left,width:width}).droppable(that.dropOpts),$div.appendTo($slot));$slot.appendTo($el)}function DragDrop(element){this.elem=element,this.$elem=$(element),this.init()}var $el=$("#timetable"),$slot=$("#table-slot"),$grid=$("#table-grid"),$gridTr,$gridTd,$gridWidth,weekDays={MONDAY:0,TUESDAY:1,WEDNESDAY:2,THURSDAY:3,FRIDAY:4},types={lectures:"(L)",tutorials:"(T)",labs:"(Lab)"};DragDrop.fn=DragDrop.prototype,DragDrop.fn.init=function(){var that=this;this.module=$.data(this.elem,"module"),this.dragOpts={opacity:.6,helper:"clone",appendTo:"#primary-panel",revert:"invalid",revertDuration:200,zIndex:1e3,containment:"#primary-panel",start:$.proxy(that.dragStart,that),stop:$.proxy(that.dragStop,that)},this.dropOpts={activeClass:"bar-active",hoverClass:"bar-hover",drop:$.proxy(that.dropEvent,that)},this.$elem.on("mouseenter",".draggable",function(){var $this=$(this);$this.hasClass("ui-draggable")||that.bindDragEvent($this)})},DragDrop.fn.bindDragEvent=function(elem){elem.draggable(this.dragOpts)},DragDrop.fn.dragStart=function(event,ui){var $this=$(event.target),id=$this.attr("id"),info=id?id.split("-"):undefined,data=info?{id:info[0],type:info[1],module:this.module,slots:this.module.get(info[1]),elem:$this,dropOpts:this.dropOpts}:$this.data("slot");createDroppableSlots(data.id,data.type,data.slots,data)},DragDrop.fn.dragStop=function(event,ui){$slot.find(".temp-slot").remove()},DragDrop.fn.dropEvent=function(event,ui){var $this=$(event.target),$that=ui.draggable;ui.helper.remove(),$that.hasClass("bar")?$that.remove():$that.removeClass("draggable").draggable("disable"),$this.css("background-color","grey").removeClass("temp-slot").addClass("draggable").droppable("destroy").draggable(this.dragOpts),$slot.find(".temp-slot").remove()},$.fn.dragdrop=function(){return this.each(function(){$.data(this,"DragDrop")||$.data(this,"DragDrop",new DragDrop(this))})}})(jQuery)}),function(){function isLocalStorageNameSupported(){try{return localStorageName in win&&win[localStorageName]}catch(err){return!1}}function isGlobalStorageNameSupported(){try{return globalStorageName in win&&win[globalStorageName]&&win[globalStorageName][win.location.hostname]}catch(err){return!1}}var store={},win=window,doc=win.document,localStorageName="localStorage",globalStorageName="globalStorage",namespace="__storejs__",storage;store.disabled=!1,store.set=function(key,value){},store.get=function(key){},store.remove=function(key){},store.clear=function(){},store.transact=function(key,defaultVal,transactionFn){var val=store.get(key);transactionFn==null&&(transactionFn=defaultVal,defaultVal=null),typeof val=="undefined"&&(val=defaultVal||{}),transactionFn(val),store.set(key,val)},store.getAll=function(){},store.serialize=function(value){return JSON.stringify(value)},store.deserialize=function(value){return typeof value!="string"?undefined:JSON.parse(value)};if(isLocalStorageNameSupported())storage=win[localStorageName],store.set=function(key,val){if(val===undefined)return store.remove(key);storage.setItem(key,store.serialize(val))},store.get=function(key){return store.deserialize(storage.getItem(key))},store.remove=function(key){storage.removeItem(key)},store.clear=function(){storage.clear()},store.getAll=function(){var ret={};for(var i=0;i<storage.length;++i){var key=storage.key(i);ret[key]=store.get(key)}return ret};else if(isGlobalStorageNameSupported())storage=win[globalStorageName][win.location.hostname],store.set=function(key,val){if(val===undefined)return store.remove(key);storage[key]=store.serialize(val)},store.get=function(key){return store.deserialize(storage[key]&&storage[key].value)},store.remove=function(key){delete storage[key]},store.clear=function(){for(var key in storage)delete storage[key]},store.getAll=function(){var ret={};for(var i=0;i<storage.length;++i){var key=storage.key(i);ret[key]=store.get(key)}return ret};else if(doc.documentElement.addBehavior){var storageOwner,storageContainer;try{storageContainer=new ActiveXObject("htmlfile"),storageContainer.open(),storageContainer.write('<script>document.w=window</script><iframe src="/favicon.ico"></frame>'),storageContainer.close(),storageOwner=storageContainer.w.frames[0].document,storage=storageOwner.createElement("div")}catch(e){storage=doc.createElement("div"),storageOwner=doc.body}function withIEStorage(storeFunction){return function(){var args=Array.prototype.slice.call(arguments,0);args.unshift(storage),storageOwner.appendChild(storage),storage.addBehavior("#default#userData"),storage.load(localStorageName);var result=storeFunction.apply(store,args);return storageOwner.removeChild(storage),result}}var forbiddenCharsRegex=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g");function ieKeyFix(key){return key.replace(forbiddenCharsRegex,"___")}store.set=withIEStorage(function(storage,key,val){key=ieKeyFix(key);if(val===undefined)return store.remove(key);storage.setAttribute(key,store.serialize(val)),storage.save(localStorageName)}),store.get=withIEStorage(function(storage,key){return key=ieKeyFix(key),store.deserialize(storage.getAttribute(key))}),store.remove=withIEStorage(function(storage,key){key=ieKeyFix(key),storage.removeAttribute(key),storage.save(localStorageName)}),store.clear=withIEStorage(function(storage){var attributes=storage.XMLDocument.documentElement.attributes;storage.load(localStorageName);for(var i=0,attr;attr=attributes[i];i++)storage.removeAttribute(attr.name);storage.save(localStorageName)}),store.getAll=withIEStorage(function(storage){var attributes=storage.XMLDocument.documentElement.attributes;storage.load(localStorageName);var ret={};for(var i=0,attr;attr=attributes[i];++i)ret[attr]=store.get(attr);return ret})}try{store.set(namespace,namespace),store.get(namespace)!=namespace&&(store.disabled=!0),store.remove(namespace)}catch(e){store.disabled=!0}store.enabled=!store.disabled,typeof module!="undefined"&&typeof module!="function"?module.exports=store:typeof define=="function"&&define.amd?define("util/store",[],store):this.store=store}(),define("util/helper",["require","exports","module"],function(require,exports){exports.getSemester=function(){var acadYear,semester,today=new Date,year=today.getFullYear(),month=today.getMonth();return month<6?(acadYear=year-1+"/"+year,semester=2):(acadYear=year+"/"+(year+1),semester=1),{acadYear:acadYear,semester:semester}}}),define("api/yql",["require","exports","module","util/helper"],function(require,exports){function getCORSurl(module){return"https://aces01.nus.edu.sg/cors/jsp/report/ModuleDetailedInfo.jsp?acad_y="+module.acadYear+"&sem_c="+module.semester+"&mod_c="+module.modCode.toUpperCase()}function getYQLurl(query){return"http://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent(query)+"&format=json&callback="}function getCallback(query,callback){return function(result){result.url=query,callback(result)}}var helper=require("util/helper"),defaults=$.extend({},{modCode:"ACC1002"},helper.getSemester());exports.request=function(query,callback){$.getJSON(getYQLurl(query),getCallback(query,callback))},exports.requestModule=function(module,callback){typeof module=="string"&&(module={modCode:module});var mod=$.extend({},defaults,module),cors=getCORSurl(mod),query="select * from html where url='"+cors+"' and xpath='//table'";$.getJSON(getYQLurl(query),getCallback(cors,callback))}}),define("api/parser",["require","exports","module"],function(require,exports){function trim(str){return typeof str=="object"&&(str=JSON.stringify(str)),str?str.replace(trimLeft,"").replace(trimRight,""):""}function isDataValid(data){return data&&data.query&&data.query.results&&data.query.results.table?!0:!1}function moduleIsAvailable(data){return!/currently not available/i.test(JSON.stringify(data))}function setLatestUpdate(data){var result=/Correct as at (\d\d \w{3} \d{4} \d\d:\d\d)\"/.exec(JSON.stringify(data));Module.correctAsAt=result?result[1]:undefined}function setModuleInfo(data){var i=1,k;for(k in details)details.hasOwnProperty(k)&&(Module[k]=details[k](data[i++].td[1]))}function moduleHasLecture(data){return!/No Lecture Class/i.test(JSON.stringify(data))}function setModuleLecture(data){var lect,grp,lects=Module.lectures,i,j,k,dataLen=data.length;for(i=1;i<dataLen;i++)if(data[i].td&&data[i].td.length>=infoLen){lect={},j=0;for(k in info)info.hasOwnProperty(k)&&(lect[k]=info[k](data[i].td[j++]));grp=lect.weekDay+"-"+lect.startTime+"-"+lect.endTime,lects[grp]||(lects[grp]=[]),lects[grp].push(lect)}}function moduleHasTutorial(data){return!/No Tutorial Class or to be announced/i.test(JSON.stringify(data))}function setModuleTutorial(data){var klass,type,grp,tuts=Module.tutorials,labs=Module.labs,i,j,k,dataLen=data.length;for(i=1;i<dataLen;i++)if(data[i].td&&data[i].td.length>=infoLen){klass={},j=0,type=info.type(data[i].td[1]);for(k in info)info.hasOwnProperty(k)&&(klass[k]=info[k](data[i].td[j++]));grp=klass.weekDay+"-"+klass.startTime+"-"+klass.endTime,type==="TUTORIAL"?(tuts[grp]=tuts[grp]||[],tuts[grp].push(klass)):(labs[grp]=labs[grp]||[],labs[grp].push(klass))}}var Module,commFun=function(data){return data.p?data.p:trim(data)},contentFun=function(data){var result=data.content||data.p;return typeof result=="object"?contentFun(result):typeof result=="string"?trim(result):"ERROR: PARSE FAILED"},details={code:function(data){return commFun(data).split(" ")[0]},title:commFun,description:commFun,examinable:commFun,examDate:contentFun,credits:function(data){return parseInt(data.p,10)},prerequisite:commFun,preclusion:commFun,workload:commFun},infoLen=7,info={classNo:commFun,type:commFun,weekType:commFun,weekDay:commFun,startTime:commFun,endTime:commFun,room:contentFun},trimLeft=/^\s+/,trimRight=/(,?)\s+$/;exports.tryParse=function(data){return isDataValid(data)&&moduleIsAvailable(data.query.results.table[1].tr[1])},exports.parse=function(data){if(!isDataValid(data))return null;var result=data.query.results.table;return Module={},Module.url=data.url,moduleIsAvailable(result[1].tr[1])?(Module.isAvailable=!0,setLatestUpdate(result[1].tr[0]),setModuleInfo(result[2].tr),Module.lectures={},Module.tutorials={},Module.labs={},moduleHasLecture(result[3].tr)&&setModuleLecture(result[4].tr),moduleHasTutorial(result[5].tr)&&setModuleTutorial(result[6].tr)):Module.isAvailable=!1,Module}}),define("modal/module",["require","exports","module"],function(require,exports){function Module(data,status){this.id=data.code.replace(/[_\s\'\"]/gi,"-"),this.data=data,this.status=$.extend({},defaultStatus,status)}function convertClass(klass){var i,j=0,length,key,result=[];for(key in klass)if(klass.hasOwnProperty(key)){length=klass[key].length;for(i=0;i<length;i++)result[j++]=klass[key][i]}return result}var defaultStatus={list:undefined,allocated:{lecture:"",tutorial:"",lab:""}};return Module.Count=function(klass){var key,count=0;for(key in klass)klass.hasOwnProperty(key)&&$.isArray(klass[key])&&(count+=klass[key].length);return count},Module.Format=function(data){var m=$.extend({},data);return $.isEmptyObject(m.lectures)||(m.hasLecture=!0,m.lectures=convertClass(m.lectures)),$.isEmptyObject(m.tutorials)||(m.hasTutorial=!0,m.tutorials=convertClass(m.tutorials)),$.isEmptyObject(m.labs)||(m.hasLab=!0,m.labs=convertClass(m.labs)),m},Module.fn=Module.prototype,Module.fn.get=function(key){return this.data[key]},Module.fn.set=function(key,val){var i,keys=key.split("."),length=keys.length,parent=this.status;for(i=0;i<length-1;i++)parent[keys[i]]=parent[keys[i]]||{},parent=parent[keys[i]];parent[keys[i]]=val},Module.fn.is=function(key,val){var i,keys=key.split("."),length=keys.length,parent=this.status;for(i=0;i<length-1;i++)parent[keys[i]]=parent[keys[i]]||{},parent=parent[keys[i]];return parent[keys[i]]===val},Module.fn.count=function(type){type=type.toLowerCase();if(type==="lectures")return Module.Count(this.data.lectures);if(type==="tutorials")return Module.Count(this.data.tutorials);if(type==="labs")return Module.Count(this.data.labs)},Module.fn.format=function(){return Module.Format(this.data)},Module.fn.isSame=function(other){return typeof other=="object"?this.data.code===other.get("code"):typeof other=="string"?this.data.code===other.toUpperCase():!1},Module.fn.isAllocated=function(type,classNo){return this.status.allocated[type]==classNo},Module.fn.allocate=function(type,classNo){this.status.allocated[type]=classNo},Module.fn.toJSON=function(){return{data:this.data,status:this.status}},Module}),define("modal/modules",["require","exports","module","api/yql","api/parser","modal/module"],function(require,exports){function ModuleList(name,options){this.name=name,this.list=[],defaults.prefix=this.name+":",this.options=$.extend({},defaults,options)}function _fetch(modCode,callback){yql.requestModule(modCode,function(result){var mod=parser.parse(result);mod!==null&&(mod.isAvailable?callback(new Module(mod)):window.alert("module : "+modCode+" is not available"))})}var yql=require("api/yql"),parser=require("api/parser"),Module=require("modal/module"),defaults={mute:!1,prefix:"module:"};return ModuleList.fn=ModuleList.prototype,ModuleList.fn.find=function(mod){var i=0,len=this.list.length;for(;i<len;i++)if(this.list[i].isSame(mod))return i;return-1},ModuleList.fn.get=function(mod){return typeof mod=="number"&&mod>=0&&mod<this.list.length?this.list[mod]:typeof mod=="string"||typeof mod=="object"?this.get(this.find(mod)):null},ModuleList.fn.add=function(module,options){options=$.extend({},this.options,options),this.find(module)===-1?typeof module=="object"?this._add(module,options):typeof module=="string"&&_fetch(module,$.proxy(function(m){this._add(m,options)},this)):options.mute||$.publish(options.prefix+"addOne:duplicated",module)},ModuleList.fn._add=function(module,options){module.set("list",this.name),this.list.push(module),options.mute||$.publish(options.prefix+"addOne",[module])},ModuleList.fn.detail=function(modCode){var module=this.get(modCode);return module?module.format():null},ModuleList.fn.remove=function(mod,options){var module;return options=$.extend({},this.options,options),typeof mod=="number"&&mod>=0&&mod<this.list.length?(module=this.list.splice(mod,1)[0],options.mute||$.publish(options.prefix+"removeOne",[mod,module]),module):typeof mod=="string"||typeof mod=="object"?this.remove(this.find(mod),options):null},ModuleList.fn.clean=function(options){options=$.extend({},this.options,options),this.list=[],options.mute||$.publish(options.prefix+"clean")},ModuleList.fn.length=function(){return this.list.length},ModuleList.fn.sort=function(compareFun){this.list.sort(compareFun)},ModuleList}),define("controller/modulesController",["require","exports","module","modal/modules"],function(require,exports){var ModuleList=require("modal/modules"),modules,previews;modules=new ModuleList(planner.list.modules),previews=new ModuleList(planner.list.previews),$.subscribe("module:add",function(e,m){var mod=previews.get(m);mod?(previews.remove(mod),modules.add(mod)):modules.add(m)}),$.subscribe("module:preview",function(e,m){var mod=modules.get(m)||previews.get(m);mod?$.publish("module:detail",mod):previews.add(m)}),$.subscribe(planner.list.previews+":addOne",function(){previews.length()>20&&previews.clean()})}),define("view/addModuleView",["require","exports","module","util/store","util/helper"],function(require,exports){function updateSemester(){$("#semester").text("Year "+sem.acadYear+" SEM"+sem.semester)}function attachTypeahead(cors){cors=store.get("cors-modules"),cors&&cors.latestUpdate===planner.dataUpdate?$input.typeahead({source:cors.data}):require(["corsModulesData"],function(data){store.set("cors-modules",{latestUpdate:planner.dataUpdate,data:data}),$input.typeahead({source:data})})}function attachEvents(){$input.on("focus",function(){this.select()}),$addBtn.on("click",_clickEvent(function(modCode){$.publish("module:add",[modCode])})),$prevBtn.on("click",_clickEvent(function(modCode){$.publish("module:preview",[modCode])}))}function _clickEvent(callback){return function(e,modCode){e.preventDefault(),modCode=$input.val().split(" ")[0],modCode&&/^[a-z]{2,3}\d{4}[a-z]?$/i.test(modCode)?($input.val(""),callback(modCode)):window.alert("The module code entered is not valid!")}}var store=require("util/store"),sem=require("util/helper").getSemester(),$input=$("#mod-code"),$addBtn=$("#add-btn"),$prevBtn=$("#preview-btn");exports.init=function(){updateSemester(),attachTypeahead(),attachEvents()}}),define("hogan",["require","exports","module"],function(require,exports,module){var Hogan={};(function(Hogan,useArrayBuffer){function coerceToString(val){return String(val===null||val===undefined?"":val)}function hoganEscape(str){return str=coerceToString(str),hChars.test(str)?str.replace(rAmp,"&amp;").replace(rLt,"&lt;").replace(rGt,"&gt;").replace(rApos,"&#39;").replace(rQuot,"&quot;"):str}Hogan.Template=function(renderFunc,text,compiler,options){this.r=renderFunc||this.r,this.c=compiler,this.options=options,this.text=text||"",this.buf=useArrayBuffer?[]:""},Hogan.Template.prototype={r:function(context,partials,indent){return""},v:hoganEscape,t:coerceToString,render:function(context,partials,indent){return this.ri([context],partials||{},indent)},ri:function(context,partials,indent){return this.r(context,partials,indent)},rp:function(name,context,partials,indent){var partial=partials[name];return partial?(this.c&&typeof partial=="string"&&(partial=this.c.compile(partial,this.options)),partial.ri(context,partials,indent)):""},rs:function(context,partials,section){var tail=context[context.length-1];if(!isArray(tail)){section(context,partials,this);return}for(var i=0;i<tail.length;i++)context.push(tail[i]),section(context,partials,this),context.pop()},s:function(val,ctx,partials,inverted,start,end,tags){var pass;return isArray(val)&&val.length===0?!1:(typeof val=="function"&&(val=this.ls(val,ctx,partials,inverted,start,end,tags)),pass=val===""||!!val,!inverted&&pass&&ctx&&ctx.push(typeof val=="object"?val:ctx[ctx.length-1]),pass)},d:function(key,ctx,partials,returnFound){var names=key.split("."),val=this.f(names[0],ctx,partials,returnFound),cx=null;if(key==="."&&isArray(ctx[ctx.length-2]))return ctx[ctx.length-1];for(var i=1;i<names.length;i++)val&&typeof val=="object"&&names[i]in val?(cx=val,val=val[names[i]]):val="";return returnFound&&!val?!1:(!returnFound&&typeof val=="function"&&(ctx.push(cx),val=this.lv(val,ctx,partials),ctx.pop()),val)},f:function(key,ctx,partials,returnFound){var val=!1,v=null,found=!1;for(var i=ctx.length-1;i>=0;i--){v=ctx[i];if(v&&typeof v=="object"&&key in v){val=v[key],found=!0;break}}return found?(!returnFound&&typeof val=="function"&&(val=this.lv(val,ctx,partials)),val):returnFound?!1:""},ho:function(val,cx,partials,text,tags){var compiler=this.c,options=this.options;options.delimiters=tags;var text=val.call(cx,text);return text=text==null?String(text):text.toString(),this.b(compiler.compile(text,options).render(cx,partials)),!1},b:useArrayBuffer?function(s){this.buf.push(s)}:function(s){this.buf+=s},fl:useArrayBuffer?function(){var r=this.buf.join("");return this.buf=[],r}:function(){var r=this.buf;return this.buf="",r},ls:function(val,ctx,partials,inverted,start,end,tags){var cx=ctx[ctx.length-1],t=null;if(!inverted&&this.c&&val.length>0)return this.ho(val,cx,partials,this.text.substring(start,end),tags);t=val.call(cx);if(typeof t=="function"){if(inverted)return!0;if(this.c)return this.ho(t,cx,partials,this.text.substring(start,end),tags)}return t},lv:function(val,ctx,partials){var cx=ctx[ctx.length-1],result=val.call(cx);if(typeof result=="function"){result=coerceToString(result.call(cx));if(this.c&&~result.indexOf("{{"))return this.c.compile(result,this.options).render(cx,partials)}return coerceToString(result)}};var rAmp=/&/g,rLt=/</g,rGt=/>/g,rApos=/\'/g,rQuot=/\"/g,hChars=/[&<>\"\']/,isArray=Array.isArray||function(a){return Object.prototype.toString.call(a)==="[object Array]"}})(typeof exports!="undefined"?exports:Hogan),function(Hogan){function cleanTripleStache(token){token.n.substr(token.n.length-1)==="}"&&(token.n=token.n.substring(0,token.n.length-1))}function trim(s){return s.trim?s.trim():s.replace(/^\s*|\s*$/g,"")}function tagChange(tag,text,index){if(text.charAt(index)!=tag.charAt(0))return!1;for(var i=1,l=tag.length;i<l;i++)if(text.charAt(index+i)!=tag.charAt(i))return!1;return!0}function buildTree(tokens,kind,stack,customTags){var instructions=[],opener=null,token=null;while(tokens.length>0){token=tokens.shift();if(token.tag=="#"||token.tag=="^"||isOpener(token,customTags))stack.push(token),token.nodes=buildTree(tokens,token.tag,stack,customTags),instructions.push(token);else{if(token.tag=="/"){if(stack.length===0)throw new Error("Closing tag without opener: /"+token.n);opener=stack.pop();if(token.n!=opener.n&&!isCloser(token.n,opener.n,customTags))throw new Error("Nesting error: "+opener.n+" vs. "+token.n);return opener.end=token.i,instructions}instructions.push(token)}}if(stack.length>0)throw new Error("missing closing tag: "+stack.pop().n);return instructions}function isOpener(token,tags){for(var i=0,l=tags.length;i<l;i++)if(tags[i].o==token.n)return token.tag="#",!0}function isCloser(close,open,tags){for(var i=0,l=tags.length;i<l;i++)if(tags[i].c==close&&tags[i].o==open)return!0}function esc(s){return s.replace(rSlash,"\\\\").replace(rQuot,'\\"').replace(rNewline,"\\n").replace(rCr,"\\r")}function chooseMethod(s){return~s.indexOf(".")?"d":"f"}function walk(tree){var code="";for(var i=0,l=tree.length;i<l;i++){var tag=tree[i].tag;tag=="#"?code+=section(tree[i].nodes,tree[i].n,chooseMethod(tree[i].n),tree[i].i,tree[i].end,tree[i].otag+" "+tree[i].ctag):tag=="^"?code+=invertedSection(tree[i].nodes,tree[i].n,chooseMethod(tree[i].n)):tag=="<"||tag==">"?code+=partial(tree[i]):tag=="{"||tag=="&"?code+=tripleStache(tree[i].n,chooseMethod(tree[i].n)):tag=="\n"?code+=text('"\\n"'+(tree.length-1==i?"":" + i")):tag=="_v"?code+=variable(tree[i].n,chooseMethod(tree[i].n)):tag===undefined&&(code+=text('"'+esc(tree[i])+'"'))}return code}function section(nodes,id,method,start,end,tags){return"if(_.s(_."+method+'("'+esc(id)+'",c,p,1),'+"c,p,0,"+start+","+end+',"'+tags+'")){'+"_.rs(c,p,"+"function(c,p,_){"+walk(nodes)+"});c.pop();}"}function invertedSection(nodes,id,method){return"if(!_.s(_."+method+'("'+esc(id)+'",c,p,1),c,p,1,0,0,"")){'+walk(nodes)+"};"}function partial(tok){return'_.b(_.rp("'+esc(tok.n)+'",c,p,"'+(tok.indent||"")+'"));'}function tripleStache(id,method){return"_.b(_.t(_."+method+'("'+esc(id)+'",c,p,0)));'}function variable(id,method){return"_.b(_.v(_."+method+'("'+esc(id)+'",c,p,0)));'}function text(id){return"_.b("+id+");"}var rIsWhitespace=/\S/,rQuot=/\"/g,rNewline=/\n/g,rCr=/\r/g,rSlash=/\\/g,tagTypes={"#":1,"^":2,"/":3,"!":4,">":5,"<":6,"=":7,_v:8,"{":9,"&":10};Hogan.scan=function(text,delimiters){function addBuf(){buf.length>0&&(tokens.push(new String(buf)),buf="")}function lineIsWhitespace(){var isAllWhitespace=!0;for(var j=lineStart;j<tokens.length;j++){isAllWhitespace=tokens[j].tag&&tagTypes[tokens[j].tag]<tagTypes._v||!tokens[j].tag&&tokens[j].match(rIsWhitespace)===null;if(!isAllWhitespace)return!1}return isAllWhitespace}function filterLine(haveSeenTag,noNewLine){addBuf();if(haveSeenTag&&lineIsWhitespace())for(var j=lineStart,next;j<tokens.length;j++)tokens[j].tag||((next=tokens[j+1])&&next.tag==">"&&(next.indent=tokens[j].toString()),tokens.splice(j,1));else noNewLine||tokens.push({tag:"\n"});seenTag=!1,lineStart=tokens.length}function changeDelimiters(text,index){var close="="+ctag,closeIndex=text.indexOf(close,index),delimiters=trim(text.substring(text.indexOf("=",index)+1,closeIndex)).split(" ");return otag=delimiters[0],ctag=delimiters[1],closeIndex+close.length-1}var len=text.length,IN_TEXT=0,IN_TAG_TYPE=1,IN_TAG=2,state=IN_TEXT,tagType=null,tag=null,buf="",tokens=[],seenTag=!1,i=0,lineStart=0,otag="{{",ctag="}}";delimiters&&(delimiters=delimiters.split(" "),otag=delimiters[0],ctag=delimiters[1]);for(i=0;i<len;i++)state==IN_TEXT?tagChange(otag,text,i)?(--i,addBuf(),state=IN_TAG_TYPE):text.charAt(i)=="\n"?filterLine(seenTag):buf+=text.charAt(i):state==IN_TAG_TYPE?(i+=otag.length-1,tag=tagTypes[text.charAt(i+1)],tagType=tag?text.charAt(i+1):"_v",tagType=="="?(i=changeDelimiters(text,i),state=IN_TEXT):(tag&&i++,state=IN_TAG),seenTag=i):tagChange(ctag,text,i)?(tokens.push({tag:tagType,n:trim(buf),otag:otag,ctag:ctag,i:tagType=="/"?seenTag-ctag.length:i+otag.length}),buf="",i+=ctag.length-1,state=IN_TEXT,tagType=="{"&&(ctag=="}}"?i++:cleanTripleStache(tokens[tokens.length-1]))):buf+=text.charAt(i);return filterLine(seenTag,!0),tokens},Hogan.generate=function(tree,text,options){var code='var _=this;_.b(i=i||"");'+walk(tree)+"return _.fl();";return options.asString?"function(c,p,i){"+code+";}":new Hogan.Template(new Function("c","p","i",code),text,Hogan,options)},Hogan.parse=function(tokens,text,options){return options=options||{},buildTree(tokens,"",[],options.sectionTags||[])},Hogan.cache={},Hogan.compile=function(text,options){options=options||{};var key=text+"||"+!!options.asString,t=this.cache[key];return t?t:(t=this.generate(this.parse(this.scan(text,options.delimiters),text,options),text,options),this.cache[key]=t)}}(typeof exports!="undefined"?exports:Hogan)}),define("text",{}),define("hgn",{load:function(id){throw new Error("Dynamic load not allowed: "+id)}}),define("hgn!template/module",["hogan"],function(hogan){var tmpl=new hogan.Template(function(c,p,i){var _=this;return _.b(i=i||""),_.b('<div id="'),_.b(_.v(_.f("id",c,p,0))),_.b('" class="module">'),_.b("\n"+i),_.b('<div class="module-header clearfix">'),_.b("\n"+i),_.b('  <h3 title="View Module Detail">'),_.b(_.v(_.f("code",c,p,0))),_.b("</h3>"),_.b("\n"+i),_.b('  <div class="module-control">'),_.b("\n"+i),_.b('    <i class="icon-remove" tilte="Remove"></i>'),_.b("\n"+i),_.b("  </div>"),_.b("\n"+i),_.b("</div>"),_.b("\n"+i),_.b("  <h4>"),_.b(_.v(_.f("title",c,p,0))),_.b("</h4>"),_.b("\n"+i),_.b("  <h5>"),_.b(_.v(_.f("examDate",c,p,0))),_.b("</h5>"),_.b("\n"+i),_.b('<div class="module-class">'),_.b("\n"+i),_.s(_.f("lectures",c,p,1),c,p,0,298,439,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b('  <span id="'),_.b(_.v(_.f("id",c,p,0))),_.b('-lectures" class="label label-large basket-lecture draggable" data-type="lecture" data-count="'),_.b(_.v(_.f("lectures",c,p,0))),_.b('">LECT</span>'),_.b("\n")}),c.pop()),_.s(_.f("tutorials",c,p,1),c,p,0,469,613,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b('  <span id="'),_.b(_.v(_.f("id",c,p,0))),_.b('-tutorials" class="label label-large basket-tutorial draggable" data-type="tutorial" data-count="'),_.b(_.v(_.f("tutorials",c,p,0))),_.b('">TUT</span>'),_.b("\n")}),c.pop()),_.s(_.f("labs",c,p,1),c,p,0,639,763,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b('  <span id="'),_.b(_.v(_.f("id",c,p,0))),_.b('-labs" class="label label-large basket-lab draggable" data-type="lab" data-count="'),_.b(_.v(_.f("labs",c,p,0))),_.b('">LAB</span>'),_.b("\n")}),c.pop()),_.b("</div>"),_.b("\n"+i),_.b("</div>"),_.b("\n"),_.fl()},"",hogan);return function(){return tmpl.render.apply(tmpl,arguments)}}),define("view/moduleView",["require","exports","module","hgn!template/module"],function(require,exports){var template=require("hgn!template/module");exports.render=function(module){var context={id:module.id,code:module.get("code"),title:module.get("title"),examDate:module.get("examDate"),lectures:module.count("lectures"),tutorials:module.count("tutorials"),labs:module.count("labs")},$module=$(template(context)).data("module",module);return $module.dragdrop(),$module}}),define("view/basketView",["require","exports","module","view/moduleView"],function(require,exports){function _getElWidth(){var $modules=$el.find(".module"),len=$modules.length,width=$modules.outerWidth();return(width+10)*len}var moduleView=require("view/moduleView"),$el=$("#basket-scroll"),$basket=$("#basket");exports.init=function(){$el.on("click","h3",function(){$.publish("module:preview",$(this).text())}),$basket.droppable({accept:".bar",active:"remove-bar-active",hoverClass:"remove-bar-hover",drop:function(event,ui){var data=ui.draggable.data("slot");data.elem.addClass("draggable").draggable("enable"),ui.helper.remove(),ui.draggable.remove()}})},$.subscribe("modules:addOne",function(e,mod){$el.prepend(moduleView.render(mod)).css("width",_getElWidth())})}),define("hgn!template/moduleDetail",["hogan"],function(hogan){var tmpl=new hogan.Template(function(c,p,i){var _=this;return _.b(i=i||""),_.b('<div id="module-detail" data-modcode="'),_.b(_.v(_.f("code",c,p,0))),_.b('">'),_.b("\n"+i),_.b("<h3>"),_.b("\n"+i),_.b('    <a href="'),_.b(_.v(_.f("url",c,p,0))),_.b('" target="_blank" title="View on CORS"><i class="icon-external-link"></i></a> '),_.b("\n"+i),_.b('    <span class="detail-head" title="Double click to add Module '),_.b(_.v(_.f("code",c,p,0))),_.b('">Module Details ['),_.b(_.v(_.f("code",c,p,0))),_.b("]</span>"),_.b("\n"+i),_.b("</h3>"),_.b("\n"+i),_.b("<h4><small>Correct As At: "),_.b(_.v(_.f("correctAsAt",c,p,0))),_.b("</small></h4>"),_.b("\n"+i),_.b("\n"+i),_.b('<table class="table table-condensed table-striped">'),_.b("\n"+i),_.b("  <thead>"),_.b("\n"+i),_.b("    <tr>"),_.b("\n"+i),_.b('      <th>Module</th><td colspan="3">'),_.b(_.v(_.f("code",c,p,0))),_.b(" - "),_.b(_.v(_.f("title",c,p,0))),_.b("</td>"),_.b("\n"+i),_.b("    </tr>"),_.b("\n"+i),_.b("    <tr>"),_.b("\n"+i),_.b('      <th>Description</th><td colspan="3">'),_.b(_.v(_.f("description",c,p,0))),_.b("</td>"),_.b("\n"+i),_.b("    </tr>"),_.b("\n"+i),_.b("    <tr>"),_.b("\n"+i),_.b('      <th>Exam Date</th><td colspan="3">'),_.b(_.v(_.f("examDate",c,p,0))),_.b("</td>"),_.b("\n"+i),_.b("    </tr>"),_.b("\n"+i),_.b("    <tr>"),_.b("\n"+i),_.b("      <th>Credits</th><td>"),_.b(_.v(_.f("credits",c,p,0))),_.b("</td><th>Workload</th><td>"),_.b(_.v(_.f("workload",c,p,0))),_.b("</td>"),_.b("\n"+i),_.b("    </tr>"),_.b("\n"+i),_.b("  </thead>"),_.b("\n"+i),_.b("  <tbody>"),_.b("\n"+i),_.b('    <tr><td colspan="4"> </td></tr>'),_.b("\n"+i),_.s(_.f("hasLecture",c,p,1),c,p,0,799,1084,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b('    <tr class="header">'),_.b("\n"+i),_.b('      <th colspan="4"><i class="icon-circle-arrow-right"></i> Lectures</th>'),_.b("\n"+i),_.b("    </tr>"),_.b("\n"+i),_.s(_.f("lectures",c,p,1),c,p,0,927,1068,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b("    <tr>"),_.b("\n"+i),_.b("      <td>["),_.b(_.v(_.f("classNo",c,p,0))),_.b("]</td><td>"),_.b(_.v(_.f("weekType",c,p,0))),_.b("</td><td>"),_.b(_.v(_.f("weekDay",c,p,0))),_.b("<br/>"),_.b(_.v(_.f("startTime",c,p,0))),_.b("-"),_.b(_.v(_.f("endTime",c,p,0))),_.b("</td><td>"),_.b(_.v(_.f("room",c,p,0))),_.b("</td>"),_.b("\n"+i),_.b("    </tr>"),_.b("\n")}),c.pop())}),c.pop()),_.s(_.f("hasTutorial",c,p,1),c,p,0,1118,1406,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b('    <tr class="header">'),_.b("\n"+i),_.b('      <th colspan="4"><i class="icon-circle-arrow-right"></i> Tutorials</th>'),_.b("\n"+i),_.b("    </tr>"),_.b("\n"+i),_.s(_.f("tutorials",c,p,1),c,p,0,1248,1389,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b("    <tr>"),_.b("\n"+i),_.b("      <td>["),_.b(_.v(_.f("classNo",c,p,0))),_.b("]</td><td>"),_.b(_.v(_.f("weekType",c,p,0))),_.b("</td><td>"),_.b(_.v(_.f("weekDay",c,p,0))),_.b("<br/>"),_.b(_.v(_.f("startTime",c,p,0))),_.b("-"),_.b(_.v(_.f("endTime",c,p,0))),_.b("</td><td>"),_.b(_.v(_.f("room",c,p,0))),_.b("</td>"),_.b("\n"+i),_.b("    </tr>"),_.b("\n")}),c.pop())}),c.pop()),_.s(_.f("hasLab",c,p,1),c,p,0,1436,1709,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b('    <tr class="header">'),_.b("\n"+i),_.b('      <th colspan="4"><i class="icon-circle-arrow-right"></i> Labs</th>'),_.b("\n"+i),_.b("    </tr>"),_.b("\n"+i),_.s(_.f("labs",c,p,1),c,p,0,1556,1697,"{{ }}")&&(_.rs(c,p,function(c,p,_){_.b("    <tr>"),_.b("\n"+i),_.b("      <td>["),_.b(_.v(_.f("classNo",c,p,0))),_.b("]</td><td>"),_.b(_.v(_.f("weekType",c,p,0))),_.b("</td><td>"),_.b(_.v(_.f("weekDay",c,p,0))),_.b("<br/>"),_.b(_.v(_.f("startTime",c,p,0))),_.b("-"),_.b(_.v(_.f("endTime",c,p,0))),_.b("</td><td>"),_.b(_.v(_.f("room",c,p,0))),_.b("</td>"),_.b("\n"+i),_.b("    </tr>"),_.b("\n")}),c.pop())}),c.pop()),_.b("  </tbody>"),_.b("\n"+i),_.b("</table>"),_.b("\n"+i),_.b("</div>"),_.b("\n"),_.fl()},"",hogan);return function(){return tmpl.render.apply(tmpl,arguments)}}),define("view/detailView",["require","exports","module","hgn!template/moduleDetail"],function(require,exports){function _showModuleDetail(e,module){module?$el.html(template(module.format())):$el.html("<p>Module Details are not found. :(</p>")}var $el=$("#detail"),template=require("hgn!template/moduleDetail");exports.init=function(){$el.on("dblclick","h3",function(){var code=$(this).closest("#module-detail").data("modcode");$.publish("module:add",[code])})},$.subscribe("app:user:new",function(){$el.empty().append("<p>Welcome! Your are using Version "+planner.version+"</p>")}),$.subscribe("app:user:updated",function(){$el.empty().append("<p>Your just updated to Version "+planner.version+"</p>")}),$.subscribe("app:user:uptodate",function(){$el.empty().append("<p>Welcome come back! Version "+planner.version+"</p>")}),$.subscribe("module:detail",_showModuleDetail),$.subscribe(planner.list.previews+":addOne",_showModuleDetail)}),define("view/timetableView",["require","exports","module"],function(require,exports){function _render(type,start,end){_type=type||_type,_type==="vertical"?_renderVertical(start,end):_renderHorizontal(start,end)}function _tableHead(){return"<table class='"+_type+" table table-striped table-bordered' "+"data-type='"+_type+"' data-starthour='"+_startHour+"' data-endhour='"+_endHour+"'>"}function _renderHorizontal(start,end){_startHour=start||_startHour,_endHour=end||_endHour;var i,j,k,len,thead=[],tbody=[],table=[_tableHead()];for(i=_startHour,j=0;i<=_endHour;i++,j++)thead[j]="<th colspan='2'>"+(i<10?"0"+i:i)+"</th>";table.push("<thead><tr><th></th>"+thead.join("")+"</tr></thead>");for(i=0,j=0,len=weekDays.length;i<len;i++,j++){tbody[j]="<tr><td class='weekday'>"+weekDays[i]+"</td>";for(k=_startHour;k<=_endHour;k++)tbody[j]+="<td></td><td></td>";tbody[j]+="</tr>"}table.push("<tbody>"+tbody.join(" ")+"</tbody"),$grid.html(table.join(""))}function _renderVertical(start,end){_startHour=start||_startHour,_endHour=end||_endHour;var i,j,k,len,thead=[],tbody=[],table=[_tableHead()];for(i=0,len=weekDays.length;i<len;i++)thead[i]="<th>"+weekDays[i]+"</th>";table.push("<thead><tr><th></th>"+thead.join("")+"</tr></thead>");for(i=_startHour,j=0;i<=_endHour;i++,j++){tbody[j]="<tr><td class='weekday' rowspan='2'>"+(i<10?"0"+i:i)+":00 - "+(i+1<10?"0"+(i+1):i+1)+":00</td>";for(k=0;k<len;k++)tbody[j]+="<td></td>";tbody[j]+="</tr><tr>";for(k=0;k<len;k++)tbody[j]+="<td></td>";tbody[j]+="</tr>"}table.push("<tbody>"+tbody.join(" ")+"</tbody>"),$grid.html(table.join(""))}var _type="horizontal",_tableRender=_renderHorizontal,_startHour=8,_endHour=21,$grid=$("#table-grid"),weekDays=["MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY"];exports.init=_render,exports.render=_render}),define("view/plannerView",["require","exports","module","view/timetableView"],function(require,exports){var timetableView=require("view/timetableView");exports.init=function(){timetableView.init(planner.timetable)},$.subscribe("timetable:range",function(e,start,end){timetableView.render(planner.timetable,start,end)}),$.subscribe("timetable:type",function(e,type){timetableView.render(type)})}),define("view/appView",["require","exports","module","view/addModuleView","view/basketView","view/detailView","view/plannerView"],function(require,exports){function initMisc(){$("#nav").tooltip({placement:"bottom",selector:"a[rel=tooltip]"}),$("#footer").tooltip({placement:"top",selector:"a[rel=tooltip]"}),$(window).bind("resize",function(e){$("#detail").css({height:$(this).height()-138,"min-height":$("#primary-panel").height()})}).trigger("resize")}var addModuleView=require("view/addModuleView"),basketView=require("view/basketView"),detailView=require("view/detailView"),plannerView=require("view/plannerView");exports.render=function(){addModuleView.init(),plannerView.init(),basketView.init(),detailView.init(),initMisc()}}),define("app/app",["require","exports","module","app/global","jquery-ui","bootstrap","util/pubsub","helper/dragdrop","util/store","controller/modulesController","view/appView"],function(require,exports){function _versionCheck(_version){_version=store.get("version"),store.set("version",planner.version),$.publish("app:user:"+(_version?_version<planner.version?"updated":"uptodate":"new"))}require("app/global"),require("jquery-ui"),require("bootstrap"),require("util/pubsub"),require("helper/dragdrop");var store=require("util/store"),modulesController=require("controller/modulesController"),appView=require("view/appView");exports.init=function(v){appView.render(),_versionCheck()}}),require.config({baseUrl:"js/libs",paths:{bootstrap:"bootstrap/bootstrap.min","jquery-ui":"jquery-ui-1.8.23.custom",hgn:"requirejs-plugins/hgn",text:"requirejs-plugins/text",hogan:"requirejs-plugins/hogan",app:"../app",api:"../app/api",modal:"../app/modals",view:"../app/views",controller:"../app/controllers",helper:"../app/helpers",corsModulesData:"../data/corsModuleCodes",util:"../utils",template:"../../templates"},hgn:{templateExtension:".mustache"}}),require(["app/app"],function(App){$(function(){App.init()})}),define("main",function(){})